# 1. 操作系统概述

















## 1.1操作系统的概念功能



### 操作系统的概念

- 负责管理协调硬件、软件等计算机资源的工作
- 为上层用户、应用程序提供简单易用的服务
- 是一种系统软件



### 操作系统的功能和目标

- 资源管理者
  - 处理机管理
  - 存储器管理
  - 文件管理
  - 设备管理
- 向上层提供服务
  - 给普通用户的
    - GUI界面
    - 命令接口
      - 联机命令接口
      - 脱机命令接口
  - 给程序员使用的
    - 程序接口
      - 系统调用
- 对硬件机器的扩展
  - 在裸机上安装的操作系统， 可以提供资源管理功能和方便用户的服务功能，将裸机改造成功能 更强、使用更方便的机器













## 1.2 操作系统的特征







### 操作系统的四个特征





#### 1.并发（基本特征）

并发：指两个或多个事件在同一时间间隔内发生。这些事件宏观上是同时发生的，但微观上是交替发生的

并行：指两个或多个事件在同一时刻同时发生





#### 2.共享（基本特征）

- 互斥共享

​		一个时间段内只允 许一个进程访问该资源

- 同时共享

​		允许一个时间段 内由多个进程“同时”对它们进行访问

互斥共享方式：使用QQ和微信视频。同一时间段内摄像头只能分配给其中一个进程。 

同时共享方式：使用QQ发送文件A，同时使用微信发送文件B。宏观上看，两边都在同时读取并发送文件， 说明两个进程都在访问硬盘资源，从中读取数据。微观上看，两个进程是交替着访问硬盘的。









#### 3.虚拟

虚拟是指把一个物理上的实体变为若干个逻辑上的对应物。



虚拟技术中的“空分复用技术”。微观上内存在各个微小的时间段内交替 着为各个进程服务

虚拟技术中的“时分复用技术”。微观上处理机在各个微小的时间段内交替 着为各个进程服务







#### 4.异步

异步是指，在多道程序环境下，允许多个程序并发执行，但由于资源有限，进程的执行不是一贯到底的， 而是走走停停，以不可预知的速度向前推进，这就是进程的异步性。

如果失去了并发性，即系统只能串行地 运行各个程序，那么每个程序的执行会 一贯到底。只有系统拥有并发性，才有 可能导致异步性。





#### 各个特征之间的关系



并发和共享互为存在条件 

没有并发和共享，就谈不上虚拟和异步，

因此并发和共享是操作系统的两个最基本的特征





并发与共享的关系

使用QQ发送文件A，同时使用微信发送文件B。 

1、两个进程正在并发执行（并发性） 

2、需要共享地访问硬盘资源（共享性）









## 1.3 操作系统的发展和分类



### 1.手工操作阶段



### 2.批处理阶段



#### 单道批处理系统

​	引入脱机输入输出技术，内存中仅能 有一道程序运行，只有该程序运行结束之后才 能调入下一道程序。

​	优点：缓解人机交互速度

​	缺点：存中仅能 有一道程序运行，只有 该程序运行结束之后才 能调入下一道程序。 CPU有大量的时间是在 空闲等待I/O完成。





#### 多道批处理系统

​	优点：多道程序并发执行，共享计算机资源。

​	缺点：不提供人机交互







### 3.分时操作系统

​	计算机以时间片为单位轮流为各个用户/作业服务，各个用户可通过终端与计算机进行交互。

​	优点：用户请求可以被即时响应，解决了人机交互问题

​	缺点：不能优先处理一些紧急任务







### 4.实时操作系统

硬实时操作系统：要在严格的时限内处理完事件。

软实时操作系统：能接受偶尔违反时间规定









## 1.4 操作系统的运行机制与体系结构



### 运行机制

两种指令：特权指令和非特权指令

两种处理器状态：核心态（特权指令、非特权指令都可以执行）和用户态（cpu只执行非特权指令）

​	用程序状态字寄存器(PSW)中的某标志位来标识当前处理器处于什么状态。如0为用户态,1为核心态

两种程序：内核程序和应用程序



1,特权指令只能在核心态下执行

2.内核程序只能在核心态下执行



### 操作系统内核

内核是计算机上配置的底层软件，是操作系统最基本、最核心的部分。

实现操作系统内核功能的那些程序就是内核程序。

![image-20220524163713622](https://s2.loli.net/2022/05/24/YJQTjWwZ2copef3.png)

![image-20220524163610773](https://s2.loli.net/2022/05/24/V1nLk4JIUQdPrZx.png)







### 体系结构

![image-20220524163738319](https://s2.loli.net/2022/05/24/aXiMHEuj2AsyQ3x.png)













## 1.5 中断和异常



### 中断的概念和作用

1.当中断发生时，CPU立即进入核心态

2.当中断发生后，当前运行的进程暂停运行，并由操作系统内核对中断进行处理

3.对于不同的中断信号，会进行不同的处理



#### 用户态和核心态之间的切换

中断可以使CPU从用户态切换为核心态，使操作系统获得计算机的控制权

“用户态→核心态”是通过中断实现的。并且中断是唯一途径。

“核心态→用户态”的切换是通过执行一个特权指令,将程序状态字(PSW)的标志位设置为“用户态”





### 中断的分类

- 内中断（信号来源cpu内部）
  - 自愿中断：系统调用（陷入指令，trap指令）
  - 强迫中断：硬件故障（缺页），软件中断（除0）
- 外中断（信号来源cpu外部）
  - 外设请求
  - 人工干预





### 外中断处理过程

每条指令执行结束后, CPU检查是否有外部中断信号

若有外部中断信号,则需要保护被中断进程的CPU环境

根据中断信号类型转入相应的中断处理程序

恢复原进程的CPU环境并退出中断,返回原进程继续往下执行









## 1.6 系统调用



### 系统调用的概念

操作系统提供给应用程序的接口

应用程序通过系统调用请求获得操作系统的服务

系统调用可以使处理器从用户态进入核心态

![image-20220524165440498](https://s2.loli.net/2022/05/24/iX98WPdBZHCU1LQ.png)







### 系统调用和库函数的区别

系统调用是操作系统向上层提供接口

库函数是对系统调用的进一步封装

通过高级语言提供的库函数来间接的进行系统调用





### 系统调用的过程

1. 传递系统调用参数
2. 执行陷入指令
3. 执行系统调用相应服务程序
4. 返回用户程序

系统调用发生在用户态，对系统调用的处理发生在核心态















# 2.进程与线程









## 2.1 进程与线程







### 2.1.1 进程的定义 组成 组织方式 特征



#### 进程的定义

- 进程就是一个指令序列
- **PCB**，**程序段，数据段**三部分构成了进程实体
- PCB（进程控制块），用来描述进程的各种信息
- **PCB是进程存在的唯一标志**
- 进程是进程实体的运行过程，是系统进行**资源分配**和**调度**的一个独立单位



#### 进程的组织

- 链接方式
  - 按照进程状态将PCB分为多个队列
  - 操作系统持有指向各个队列的指针

执行指针（当前处于运行态的进程）

就绪队列指针（处于就绪态的进程）

阻塞队列指针（处于阻塞态的进程）

指针指向的都是队列，优先级高的进程在队头



- 索引方式
  - 根据进程状态的不同，建立几张索引表
  - 操作系统持有指向各个索引表的指针

执行指针（当前处于运行态的进程）

就绪队列指针（处于就绪态的进程）

阻塞队列指针（处于阻塞态的进程）

指针指向的都是索引表



#### 进程的特征

动态性：最基本的特征

并发性

独立性：进程是资源分配，接受调度的基本单元

异步性

结构性

















### 2.1.2 进程的状态与转换



#### 进程的状态

运行状态：占用cpu

就绪状态：已具备运行条件，由于无空闲CPU，而不能运行

阻塞状态：因等待某事件而不能运行

创建状态：进程正在被创建，初始化PCB，分配资源

终止状态：撤销进程，撤销PCB,撤销资源







#### 进程之间的状态转换



![image-20220525160717476](https://s2.loli.net/2022/05/25/JBbvGghxdWZLVUe.png)











### 2.1.3 进程的控制



进程控制就是实现进程状态转换，即五个状态之间的转换



#### 实现进程控制

使用原语实现，这种不可以被中断的操作即原子操作

原语采用“关中断指令”和“开中断指令”实现

![image-20220525163128784](https://s2.loli.net/2022/05/25/GxALRa6Yd94wFDZ.png)

关/开中断指令的权限非常大,必然是只允许在核心态下执行的特权指令



进程控制需要完成的步骤

1.更新PCB中的信息(如修改进程状态标志、将运行环境保存到PCB、从PCB恢复运行环境)

​	a.所有的进程控制原语一定都会修改进程状态标志

​	b.剥夺当前运行进程的CPU使用权必然需要保存其运行环境

​	c.某进程开始运行前必然要恢复期运行环境

2.将PCB插入合适的队列

3.分配/回收资源









### 2.1.4 进程通信

进程通信就是进程之间的信息交换









